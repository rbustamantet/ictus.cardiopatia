<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Escala de Fisher — Hemorragia Subaracnoidea</title>
<style>
  :root{
    --bg:#f8fafc; --ink:#0f172a;
    --azul:#0b2c5f; --gris:#6b7280; --borde:#e5e7eb;
    --ok:#0a7f3f; --error:#b91c1c;
    --accent:#2563eb; --accent-light:#dbeafe;
  }
  html, body{
    font-family: Verdana, Geneva, Tahoma, sans-serif;
    background:var(--bg); color:var(--ink);
    margin:0; padding:0;
  }

  /* === Cabecera pegajosa === */
  .appbar{
    position:sticky; top:0; z-index:1000;
    background:rgba(255,255,255,0.9);
    border-bottom:1px solid var(--accent-light);
    backdrop-filter:saturate(140%) blur(8px);
    -webkit-backdrop-filter:saturate(140%) blur(8px);
    transition:box-shadow .15s, border-color .15s, background .15s;
  }
  .appbar.scrolled{box-shadow:0 8px 24px rgba(0,0,0,.08); border-color:#e2e8f0}
  .appbar-inner{max-width:980px; margin:0 auto; display:flex; align-items:center; gap:12px; padding:10px 16px}
  .appbar h1{margin:0; font-size:22px; line-height:1.2; color:var(--accent); font-weight:800}
  .spacer{flex:1}
  .pill{
    display:inline-block; max-width:60vw;
    padding:6px 10px; border-radius:999px;
    background:var(--accent-light); color:#1e3a8a; border:1px solid #bfdbfe;
    font-size:12px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  @media (min-width:640px){ .pill{ max-width:420px } }

  /* === Contenido === */
  .container{max-width:880px; margin:16px auto 48px; padding:0 16px}
  .card{
    background:#fff; border:1px solid var(--borde);
    border-radius:16px; padding:18px;
    box-shadow:0 2px 10px rgba(15,23,42,.06);
    transition:box-shadow .2s;
  }
  .card:hover{box-shadow:0 4px 16px rgba(15,23,42,.1)}
  .grid{display:grid; grid-template-columns:1fr; gap:16px}
  @media (min-width:720px){ .grid{ grid-template-columns:1.05fr .95fr } }
  label{font-size:14px; font-weight:700; display:block; margin-bottom:6px; color:var(--azul)}
  select{
    width:100%; border:1px solid var(--borde); border-radius:10px;
    padding:12px 12px; font-size:15px; background:#fff; outline:none; cursor:pointer;
  }
  select:focus{border-color:var(--azul); box-shadow:0 0 0 3px rgba(11,44,95,.12)}

  .row{display:grid; grid-template-columns:1fr 1fr; gap:14px}
  @media (max-width:620px){ .row{ grid-template-columns:1fr } }

  .muted{color:var(--gris); font-size:12px; margin-top:8px}

  .result{display:none}
  .result.show{display:block}

  .no-break,
  .proto-title,
  .proto-desc{
    word-break: normal !important;
    overflow-wrap: normal !important;
    hyphens: none !important;
  }

  .error{
    border-radius:12px; padding:12px 14px; margin-top:10px;
    background:#fef2f2; color:var(--error); border:1px solid #fecaca;
  }

  .protocol{
    display:grid; grid-template-columns:72px 1fr; gap:14px;
    align-items:center; border-top:1px solid var(--borde);
    margin-top:16px; padding-top:16px;
  }
  .badge{width:72px; height:72px}
  .proto-title{font-size:16px; font-weight:700; color:var(--azul); margin:0 0 6px 0}
  .proto-desc{margin:0; font-size:13px; color:#111827}
  .proto-list{margin:8px 0 0 16px; padding:0; font-size:13px}

  footer.smallprint{margin-top:20px; font-size:11px; color:var(--gris)}
</style>
</head>
<body>

<header class="appbar" role="region" aria-label="Cabecera Fisher">
  <div class="appbar-inner">
    <h1>Escala de Fisher</h1>
    <div class="spacer"></div>
    <output id="pill" class="pill" aria-live="polite" aria-atomic="true">Fisher: —</output>
  </div>
</header>

<div class="container">
  <div class="grid">
    <div class="card">
      <form id="calcForm" autocomplete="off">
        <div class="row">
          <div>
            <label for="cisternal">Sangre cisternal visible en TC</label>
            <select id="cisternal">
              <option value="" selected>— Seleccione —</option>
              <option value="no">No</option>
              <option value="si">Sí</option>
            </select>
          </div>
          <div>
            <label for="espesor">Espesor máx. en cisternas verticales</label>
            <select id="espesor">
              <option value="" selected>— Seleccione —</option>
              <option value="sin">Sin sangre</option>
              <option value="lt1">&lt; 1 mm</option>
              <option value="gt1">&gt; 1 mm</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="coagulos">Coágulos cisternales localizados</label>
            <select id="coagulos">
              <option value="" selected>— Seleccione —</option>
              <option value="no">No</option>
              <option value="si">Sí</option>
            </select>
          </div>
          <div>
            <label for="ivhich">Sangrado intraventricular o intraparenquimatoso</label>
            <select id="ivhich">
              <option value="" selected>— Seleccione —</option>
              <option value="no">No</option>
              <option value="si">Sí</option>
            </select>
          </div>
        </div>

        <p class="muted">Criterios (Fisher 1980): I sin sangre cisternal · II fina (&lt;1 mm) · III coágulos / &gt;1 mm · IV HIV/HIP con o sin HSA difusa.</p>
      </form>
    </div>

    <div id="resultCard" class="card result" aria-live="assertive">
      <div id="errBox" class="error" style="display:none;"></div>

      <!-- Se elimina el bloque KPI redundante -->

      <div class="protocol">
        <div id="badge" class="badge" aria-hidden="true"></div>
        <div>
          <p class="proto-title no-break">Resultado: <span id="gradoTxt">—</span></p>
          <p class="proto-desc" id="descTxt"></p>
          <ul class="proto-list" id="auxList"></ul>
        </div>
      </div>

      <footer class="smallprint">
        Referencia: Fisher CM, Kistler JP, Davis JM. <em>Neurosurgery</em>. 1980;6(1):1–9.
      </footer>
    </div>
  </div>
</div>

<script>
  var appbar = document.querySelector('.appbar');
  function onScroll(){
    if(!appbar) return;
    (window.scrollY>8)?appbar.classList.add('scrolled'):appbar.classList.remove('scrolled');
  }
  document.addEventListener('scroll', onScroll, {passive:true}); onScroll();

  var SEP = ' \u2014 ';
  var shortMap = {
    'I':'Sin sangre cisternal',
    'II':'Sangre difusa < 1 mm',
    'III':'Coágulos y/o > 1 mm',
    'IV':'HIV/HIP con o sin HSA'
  };
  function updateHeaderPill(grado){
    var pill = document.getElementById('pill');
    if(!pill) return;
    pill.textContent = grado ? 'Fisher: ' + grado + SEP + (shortMap[grado] || '') : 'Fisher: —';
  }

  function svgBadge(texto){
    return ''
      + '<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Grado ' + texto + '">'
      + '  <defs><radialGradient id="g" cx="50%" cy="50%" r="60%">'
      + '    <stop offset="0%" stop-color="#ffffff"></stop>'
      + '    <stop offset="100%" stop-color="#dbeafe"></stop>'
      + '  </radialGradient></defs>'
      + '  <circle cx="60" cy="60" r="56" fill="url(#g)" stroke="#2563eb" stroke-width="6"></circle>'
      + '  <text x="50%" y="56%" dominant-baseline="middle" text-anchor="middle"'
      + '        font-family="Verdana, Geneva, Tahoma, sans-serif" font-weight="700"'
      + '        font-size="48" fill="#0b2c5f">' + texto + '</text>'
      + '</svg>';
  }

  var descripciones = {
    'I'  : {t:'Sin sangre visible en cisternas o surcos.', aux:['Riesgo de vasoespasmo: bajo.']},
    'II' : {t:'Capa fina de sangre difusa (< 1 mm) en cisternas o surcos.', aux:['Riesgo de vasoespasmo: intermedio-bajo.']},
    'III': {t:'Coágulos localizados o capa de sangre > 1 mm.', aux:['Riesgo de vasoespasmo: alto (mayor probabilidad de deterioro tardío).']},
    'IV' : {t:'Hemorragia intraventricular (HIV) o intraparenquimatosa (HIP) con o sin hemorragia subaracnoidea difusa.', aux:['Riesgo de vasoespasmo: intermedio-alto, variable según extensión y localización.']}
  };

  function calcular(){
    var cisternal = document.getElementById('cisternal').value;
    var espesor   = document.getElementById('espesor').value;
    var coagulos  = document.getElementById('coagulos').value;
    var ivhich    = document.getElementById('ivhich').value;

    var resultCard = document.getElementById('resultCard');
    var errBox = document.getElementById('errBox');
    var gradoTxt = document.getElementById('gradoTxt');
    var descTxt  = document.getElementById('descTxt');
    var auxList  = document.getElementById('auxList');
    var badge    = document.getElementById('badge');

    errBox.style.display = 'none';
    errBox.textContent = '';

    if(!cisternal || !espesor || !coagulos || !ivhich){
      resultCard.classList.remove('show');
      updateHeaderPill();
      return;
    }

    var grado = 'I';
    if(ivhich === 'si'){
      grado = 'IV';
    }else if(coagulos === 'si' || espesor === 'gt1'){
      grado = 'III';
    }else if(cisternal === 'si' && espesor === 'lt1'){
      grado = 'II';
    }

    gradoTxt.textContent = 'Fisher ' + grado;
    descTxt.textContent = descripciones[grado].t;
    auxList.innerHTML = descripciones[grado].aux.map(a => '<li>' + a + '</li>').join('');
    badge.innerHTML = svgBadge(grado);
    resultCard.classList.add('show');
    updateHeaderPill(grado);
  }

  function attachAuto(){
    document.querySelectorAll('select').forEach(s=>{
      s.addEventListener('change', calcular);
      s.addEventListener('input', calcular);
    });
  }

  document.readyState==='loading'
    ? document.addEventListener('DOMContentLoaded', ()=>{attachAuto(); updateHeaderPill();})
    : (attachAuto(), updateHeaderPill());
</script>
<footer style="
    text-align:center;
    margin-top:2rem;
    padding:1rem 0;
    border-top:1px solid #e5e7eb;
    background:#ffffff;">
    <a href="https://ictusmalaga.blogspot.com" target="_blank" rel="noopener noreferrer" style="text-decoration:none;">
      <img src="https://blogger.googleusercontent.com/img/a/AVvXsEjVtODA0IhiAdybWI1agwcBIpZHwqL23SOJppZYsCnyBvnH_l43stC9yvFgOyFq060DeenIQtmBzy84RrsExZFRYWPaSKgEr4KsrDt5oRMCoZFYwfBNBYMZfzIgBZrOWCBjBhbtNQ9iuJ_y2pIdshl1Npp5CwCfCKIfptidRKhIhcVxi0n66m8AYXU4o1Q=w800"
           alt="Unidad de Ictus Málaga"
           style="max-width:320px;height:auto;opacity:.95;transition:opacity .2s;">
    </a>
  </footer>
</body>
</html>
